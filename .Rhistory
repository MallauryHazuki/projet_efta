library(tidyverse)
library(arrow)
library(glue)
library(readxl)
library(writexl)
library(openxlsx)
options(encoding = "UTF-8")
dir.create(path = "02_data/")
dir.create(path = "02_data/")
file.exitst("02_data/")
file.exist("02_data/")
file.exists("02_data/")
file.exists("02_data")
# 0. Organisation du code -------------------------------------------------
if (!file.exists("02_data")){
dir.create(path = "02_data/")
cat("Création du dossier '02_data/' pour stocker les données à télécharger...")
}
if (!file.exists("02_data")){
dir.create(path = "02_data/")
cat("Création du dossier '02_data/' pour stocker les données à télécharger...")
}
if (!file.exists("03_output")){
dir.create(path = "03_output/")
cat("Création du dossier '03_output/' pour stocker les données à télécharger...")
}
# 0. Architecture du dossier ----------------------------------------------
source("01_scripts/initialisation/init_dir.R")
if (!file.exists("02_data")){
dir.create(path = "02_data/")
cat("Création du dossier '02_data/' pour stocker les données à télécharger...")
} else {
cat("Le dossier '02_data/' existe déjà.")
}
if (!file.exists("03_output")){
dir.create(path = "03_output/")
cat("Création du dossier '03_output/' pour stocker les données à télécharger...")
} else {
cat("Le dossier '03_output/' existe déjà.")
}
if (!file.exists("02_data")){
dir.create(path = "02_data/")
cat("Création du dossier '02_data/' pour stocker les données à télécharger...")
} else {
cat("Le dossier '02_data/' existe déjà.")
}
if (!file.exists("03_output")){
dir.create(path = "03_output/")
cat("Création du dossier '03_output/' pour stocker les données à télécharger...")
} else {
cat("Le dossier '03_output/' existe déjà.")
}
# 0. Architecture du dossier ----------------------------------------------
source("01_scripts/initialisation/init_dir.R")
# 0. Architecture du dossier ----------------------------------------------
source("01_scripts/initialisation/init_dir.R")
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
source("01_scripts/initialisation/init_dir.R")
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
source("01_scripts/initialisation/init_dir.R")
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
# 0. Architecture du dossier ----------------------------------------------
source("01_scripts/initialisation/init_dir.R")
source("01_scripts/initialisation/init_dir.R")
# 0. Architecture du dossier ----------------------------------------------
source("01_scripts/initialisation/init_dir.R")
# 0. Architecture du dossier ----------------------------------------------
source("01_scripts/00_initialisation/init_dir.R")
# EFTA - ENERGUMÈNES FRANCOMORPHES TOTALEMENT ALEATOIRES ------------------
library(doremifasol)
# EFTA - ENERGUMÈNES FRANCOMORPHES TOTALEMENT ALEATOIRES ------------------
library(doremifasolData)
# EFTA - ENERGUMÈNES FRANCOMORPHES TOTALEMENT ALEATOIRES ------------------
install.packages("doremifasolData")
naf_brut <- read_excel("02_data/naf2008_5_niveaux.xls")
naf_brut
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls")
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls", skip = 1)
naf_brut
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls", skip = 1) %>%
rename(code = "code", lib = "Libellé")
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls", skip = 1) %>%
rename(code = Code, lib = Libellé)
naf_brut
cat("
TODO : utiliser doremifasol ou un autre moyen de télécharger directement cette table.
En attendant, aller sur https://www.insee.fr/fr/information/2120875 et prendre les sous-classes.
")
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls", skip = 1) %>%
rename(code = Code, lib = Libellé)
cat("
TODO : utiliser doremifasol ou un autre moyen de télécharger directement cette table.
En attendant, aller sur https://www.insee.fr/fr/information/2120875 et prendre les sous-classes.
")
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls", skip = 1) %>%
rename(code = Code, lib = Libellé)
cat("
TODO : utiliser doremifasol ou un autre moyen de télécharger directement cette table.
En attendant, aller sur https://www.insee.fr/fr/information/2120875 et prendre les sous-classes.
")
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls", skip = 1) %>%
rename(code = Code, lib = Libellé)
cat("
TODO : utiliser doremifasol ou un autre moyen de télécharger directement cette table.
En attendant, aller sur https://www.insee.fr/fr/information/2120875 et prendre les sous-classes.
")
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls", skip = 1) %>%
rename(code = Code, lib = Libellé)
naf_structure <- read_excel("02_data/naf2008_5_niveaux.xls")
naf_structure
cpf_brut <- read_excel("02_data/cpf2015_liste_n6.xls", skip = 1)
cpf_brut <- read_excel("02_data/cpf2015_liste_n6.xls", skip = 0)
cpf_brut <- read_excel("02_data/cpf2015_liste_n6.xls", skip = 1)
cpf_brut
cpf_brut <- read_excel("02_data/cpf2015_liste_n6.xls", skip = 1) %>%
rename(code = CODE, lib = LIBELLE)
cpf_brut
cat("
TODO : utiliser doremifasol ou un autre moyen de télécharger directement cette table.
En attendant, aller sur https://www.insee.fr/fr/information/2120875 et prendre les sous-classes.
")
naf_brut <- read_excel("02_data/naf2008_liste_n5.xls", skip = 1) %>%
rename(code = Code, lib = Libellé)
# naf_structure <- read_excel("02_data/naf2008_5_niveaux.xls")
if (exists("naf_brut")){
cat("
Créé le fichier 'naf_brut' avec toutes les lignes du niveau 5 de la NAF 2008 rév. 2.
"
)
}
cat("
TODO : utiliser doremifasol ou un autre moyen de télécharger directement cette table.
En attendant, aller sur https://www.insee.fr/fr/information/2399243 et prendre les sous-catégories.
")
cpf_brut <- read_excel("02_data/cpf2015_liste_n6.xls", skip = 1) %>%
rename(code = CODE, lib = LIBELLE)
if (exists("cpf_brut")){
cat("
Créé le fichier 'cpf_brut' avec toutes les lignes du niveau 6 de la CPF 2015 rév. 2.1.
")
}
naf_brut %>%
mutate(filtrage = case_when(
grep(lib, "Autre") ~ "rebut",
T ~ "selection"
))
naf_brut %>%
mutate(filtrage = case_when(
grep(x = lib, pattern = "Autre") ~ "rebut",
T ~ "selection"
))
naf_brut %>%
mutate(filtrage = case_when(
grep(x = lib, pattern = "Autre",value = T) ~ "rebut",
T ~ "selection"
))
grep(x = naf_brut$lib, pattern = "Autre", value = T)
naf_brut %>%
filter(
grep(x = lib, pattern = "Autre", value = T)
)
naf_brut %>%
filter(
grep(x = lib, pattern = "Autre", value = T)
)
naf_brut %>%
filter(
grep(x = lib, pattern = "Autre", value = T)
)
naf_brut %>%
filter(grep(x = lib, pattern = "Autre", value = T))
naf_brut %>%
filter(lib %in% grep(x = lib, pattern = "Autre", value = T))
naf_brut %>%
filter(lib %in% grep(x = lib, pattern = "Autre", value = T))
naf_brut %>%
filter(grepl("Autre", lib))
naf_brut %>%
filter(grepl("Autre", lib))
naf_brut %>%
filter(grepl("Autre", lib))
naf_brut %>%
filter(grepl("Autre", .$lib))
library(stringr)
naf_brut %>%
filter(str_detect(lib, "Autre"))
naf_brut %>%
filter(str_detect(lib, "Autre"))
naf_brut$lib
naf_brut %>%
rename(libbbe = lib)
naf_brut %>%
rename(libbbe = lib) %>%
filter(str_detect(libbbe, "Autre"))
pivot_longer()
naf_brut %>%
filter(str_detect(lib, pattern = "Autre"))
naf_brut %>%
filter(str_detect(lib, pattern = "Autre"))
naf_brut %>%
filter(stringr::str_detect(lib, pattern = "Autre"))
# 00. Architecture du dossier ----------------------------------------------
source("01_scripts/00_initialisation/init_dir.R")
# 01. Import des fichiers Insee --------------------------------------------
# TODO télécharger les bases utiles sur le site de l'Insee
source("01_scripts/01_imports/import_naf.R")
source("01_scripts/01_imports/import_cpf.R")
library(tidyverse)
library(arrow)
library(glue)
library(readxl)
library(writexl)
library(openxlsx)
library(conflicted)
conflicts_prefer(dplyr::filter)
options(encoding = "UTF-8")
naf_brut %>%
filter(stringr::str_detect(lib, pattern = "Autre"))
naf_brut %>%
filter(str_detect(lib, pattern = "Autre"))
?str_detect
naf_brut %>%
mutate(filtra = case_when(
lib %in% grepl(x = lib, pattern = "Autre")
))
#str_detect(lib, pattern = "Autre")
?grepl
naf_brut %>%
mutate(filtra = case_when(
lib %in% grepl(x = lib, pattern = "Autre", value = T)
))
naf_brut %>%
mutate(filtra = case_when(
lib %in% grep(x = lib, pattern = "Autre", value = T)
))
naf_brut %>%
mutate(filtra = case_when(
lib %in% grep(x = lib, pattern = "Autre", value = T) ~ "rebut",
T ~ "selection"
))
